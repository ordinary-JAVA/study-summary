Gap锁
Mysql gap锁为了解决事务级别为可重复读的情况下幻读问题
Gap锁加锁规则
唯一索引
精确等值检索 next_key locks就退化成记录锁 不会加gap锁
范围检索 会锁住where 条件中相应的范围 范围中的记录以及间隙 换言之就是加上记录锁和gap锁
不走索引检索 全表间隙加gap锁 全表记录加 记录锁
非唯一索引
精确等值检索 next-key locks会对间隙加gap锁 以及对应检索到的记录加记录锁
范围检索 会锁住where条件中相应的范围 范围中的记录以及间隙 换言之就是加上记录锁和gap锁
非索引检索 全局间隙gap lock 全表记录 record lock

数据库索引 是数据库管理系统中一个排序的数据结构 以协助快速查询 更新数据库表中数据 索引的实现通常使用b树及其变种b+树 在数据之外 数据库系统还维护这满足特定查找算法的数据结构 这些数据结构以某种方式引用数据 这样就可以在这些数据结构上实现高级查询算法 这种数据结构 就是索引 
为表设置索引需要付出代价 一是增加了数据库的存储空间 二是在插入和修改数据时要花费较多的时间 因为索引也要随之变动

图展示了一种可能的索引方式 左边是数据表 一共有两列七条记录 最左边的数据记录的物理地址 逻辑上相邻的记录在磁盘上也并不是一定物理相邻的  为了加快col2的查找 可以维护一个右边所示的二叉查找树 每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针 这样就可以运用二叉查找在O的复杂度获取到相应数据



索引 是数据库之上 保存的一种满足排序的数据结构  以加快数据检索 通常由b b+树实现 数据库管理这实现特定查找算法的数据结构 这种数据结构 以某种形式关联着数据 以实现数据可以实现某种算法 
2、B-tree,B+-tree
    减少查询扫描的数据量
    避免排序和临时表
    将随机io变为顺序io
平衡二叉树 是基于二分法的策略提高数据的查找速度的二叉树的数据结构
特点: 平衡二叉树是采用二分法思维把数据按规则组装成一个树形结构的数据 用这个属性结构的数据减少无关数据的索引 大大的提升了数据检索的速度 平衡二叉树的数据结构组装过程有以下规则:
非叶子节点只能允许最多两个子节点的存在 每个非叶子节点数据分布规则为左边的子节点小当前节点的值 有变动子节点大于当前节点的值
平衡树的层次结构 因为平衡二叉树查询性能和树的层级成正比 为了保证树的结构左右两端数据大致平衡降低二叉树 的查询次数 一般会采用一种算法机制实现节点数据结构的平衡 使得查找数据的速度接近于二分查找
特点:
非叶子节点最多拥有两个子节点
非叶子节值大于左边子节点 小于右边子节点
树的左右两边的层级树相差不会大于1
没有值相等重复的节点
b+树 
的非叶子节点不存储数据 所有数据存储在叶子节点中 
叶子节点包含所有数据 通过链表来使得数据有序 查找每一个数据的时间较为稳定
查找区间数据较为方便 
减少io操作 因为非叶子节点只存储索引 一次io可以加载更多非叶子节点
存储过程
    
    我们常用的操作数据库语言SQL语句在执行的时候需要要先编译，然后执行，而存储过程（Stored Procedure）是一组为了完成特定功能的SQL语句集，经编译后存储在数据库中，
    用户通过指定存储过程的名字并给定参数（如果该存储过程带有参数）来调用执行它。
    
    一个存储过程是一个可编程的函数，它在数据库中创建并保存。它可以有SQL语句和一些特殊的控制结构组成。当希望在不同的应用程序或平台上执行相同的函数，
    或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟。它允许控制数据的访问方式。
    
    优点：
    
    (1).存储过程增强了SQL语言的功能和灵活性。存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。
    
    (2).存储过程允许标准组件是编程。存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，
    对应用程序源代码毫无影响。
    
    (3).存储过程能实现较快的执行速度。如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。
    在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。
    
    (4).存储过程能过减少网络流量。针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，
    网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。
    
    (5).存储过程可被作为一种安全机制来充分利用。系统管理员通过执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，
    保证了数据的安全。
    
数据库大数据量读取
    
    多线程读写 分段, 开启事务, 数据库连接池大小 应该跟线程大小类似 如果数据库引擎是用的innodb
    利用主键索引去划分区域 会比limit快



















